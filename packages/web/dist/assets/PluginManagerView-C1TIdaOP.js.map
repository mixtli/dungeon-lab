{"version":3,"file":"PluginManagerView-C1TIdaOP.js","sources":["../../src/components/plugin/PluginManager.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref, onMounted, computed } from 'vue';\nimport { usePluginStore } from '../../stores/plugin';\nimport { useAuthStore } from '../../stores/auth';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport { Plus, Delete, Edit, Switch } from '@element-plus/icons-vue';\n\n// Stores\nconst pluginStore = usePluginStore();\nconst authStore = useAuthStore();\n\n// State\nconst isAdmin = computed(() => authStore.user?.isAdmin || false);\nconst loading = ref(false);\nconst showAddForm = ref(false);\nconst showEditForm = ref(false);\n\n// Form data\nconst newPlugin = ref({\n  name: '',\n  version: '1.0.0',\n  description: '',\n  author: '',\n  website: '',\n  type: 'gameSystem' as 'gameSystem' | 'extension' | 'theme',\n  entryPoint: '',\n  enabled: true,\n});\n\nconst editPlugin = ref({\n  id: '',\n  name: '',\n  version: '',\n  description: '',\n  author: '',\n  website: '',\n  enabled: true,\n});\n\n// Methods\nasync function loadPlugins() {\n  loading.value = true;\n  try {\n    await pluginStore.fetchPlugins();\n  } catch (error) {\n    ElMessage.error('Failed to load plugins');\n    console.error('Error loading plugins:', error);\n  } finally {\n    loading.value = false;\n  }\n}\n\nfunction resetNewPluginForm() {\n  newPlugin.value = {\n    name: '',\n    version: '1.0.0',\n    description: '',\n    author: '',\n    website: '',\n    type: 'gameSystem' as 'gameSystem' | 'extension' | 'theme',\n    entryPoint: '',\n    enabled: true,\n  };\n  showAddForm.value = false;\n}\n\nfunction prepareEditForm(plugin: any) {\n  editPlugin.value = {\n    id: plugin.id,\n    name: plugin.name,\n    version: plugin.version,\n    description: plugin.description || '',\n    author: plugin.author || '',\n    website: plugin.website || '',\n    enabled: plugin.enabled,\n  };\n  showEditForm.value = true;\n}\n\nasync function addPlugin() {\n  try {\n    loading.value = true;\n    await pluginStore.registerPlugin(newPlugin.value);\n    ElMessage.success('Plugin added successfully');\n    resetNewPluginForm();\n    await loadPlugins();\n  } catch (error) {\n    ElMessage.error('Failed to add plugin');\n    console.error('Error adding plugin:', error);\n  } finally {\n    loading.value = false;\n  }\n}\n\nasync function updatePlugin() {\n  try {\n    loading.value = true;\n    await pluginStore.updatePlugin(editPlugin.value.id, editPlugin.value);\n    ElMessage.success('Plugin updated successfully');\n    showEditForm.value = false;\n    await loadPlugins();\n  } catch (error) {\n    ElMessage.error('Failed to update plugin');\n    console.error('Error updating plugin:', error);\n  } finally {\n    loading.value = false;\n  }\n}\n\nasync function togglePluginStatus(plugin: any) {\n  try {\n    loading.value = true;\n    if (plugin.enabled) {\n      await pluginStore.disablePlugin(plugin.id);\n      ElMessage.success('Plugin disabled');\n    } else {\n      await pluginStore.enablePlugin(plugin.id);\n      ElMessage.success('Plugin enabled');\n    }\n    await loadPlugins();\n  } catch (error) {\n    ElMessage.error('Failed to toggle plugin status');\n    console.error('Error toggling plugin status:', error);\n  } finally {\n    loading.value = false;\n  }\n}\n\nasync function confirmDeletePlugin(plugin: any) {\n  try {\n    await ElMessageBox.confirm(\n      `Are you sure you want to delete the plugin \"${plugin.name}\"? This action cannot be undone.`,\n      'Delete Plugin',\n      {\n        confirmButtonText: 'Delete',\n        cancelButtonText: 'Cancel',\n        type: 'warning',\n      }\n    );\n    \n    loading.value = true;\n    await pluginStore.unregisterPlugin(plugin.id);\n    ElMessage.success('Plugin deleted successfully');\n    await loadPlugins();\n  } catch (error) {\n    if (error !== 'cancel') {\n      ElMessage.error('Failed to delete plugin');\n      console.error('Error deleting plugin:', error);\n    }\n  } finally {\n    loading.value = false;\n  }\n}\n\n// Initialize\nonMounted(async () => {\n  await loadPlugins();\n});\n</script>\n\n<template>\n  <div class=\"plugin-manager\">\n    <div class=\"flex justify-between items-center mb-6\">\n      <h1 class=\"text-2xl font-semibold\">Plugin Management</h1>\n      <el-button \n        v-if=\"isAdmin\" \n        type=\"primary\" \n        @click=\"showAddForm = true\"\n        :icon=\"Plus\"\n      >\n        Add Plugin\n      </el-button>\n    </div>\n\n    <!-- Plugin List -->\n    <el-card v-loading=\"loading\" class=\"mb-6\">\n      <template #header>\n        <div class=\"flex justify-between items-center\">\n          <span>Available Plugins</span>\n          <el-button \n            size=\"small\"\n            @click=\"loadPlugins\"\n            :loading=\"loading\"\n          >\n            Refresh\n          </el-button>\n        </div>\n      </template>\n\n      <el-table\n        :data=\"pluginStore.plugins\"\n        style=\"width: 100%\"\n        v-if=\"pluginStore.plugins.length > 0\"\n      >\n        <el-table-column prop=\"name\" label=\"Name\" />\n        <el-table-column prop=\"version\" label=\"Version\" width=\"100\" />\n        <el-table-column prop=\"type\" label=\"Type\" width=\"120\" />\n        <el-table-column label=\"Status\" width=\"120\">\n          <template #default=\"{ row }\">\n            <el-tag :type=\"row.enabled ? 'success' : 'danger'\">\n              {{ row.enabled ? 'Enabled' : 'Disabled' }}\n            </el-tag>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"Actions\" width=\"200\" v-if=\"isAdmin\">\n          <template #default=\"{ row }\">\n            <div class=\"flex space-x-2\">\n              <el-tooltip content=\"Toggle status\">\n                <el-button\n                  size=\"small\"\n                  circle\n                  :type=\"row.enabled ? 'warning' : 'success'\"\n                  @click=\"togglePluginStatus(row)\"\n                  :icon=\"Switch\"\n                />\n              </el-tooltip>\n              <el-tooltip content=\"Edit\">\n                <el-button\n                  size=\"small\"\n                  circle\n                  type=\"primary\"\n                  @click=\"prepareEditForm(row)\"\n                  :icon=\"Edit\"\n                />\n              </el-tooltip>\n              <el-tooltip content=\"Delete\">\n                <el-button\n                  size=\"small\"\n                  circle\n                  type=\"danger\"\n                  @click=\"confirmDeletePlugin(row)\"\n                  :icon=\"Delete\"\n                />\n              </el-tooltip>\n            </div>\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <div v-else class=\"text-center py-6 text-gray-500\">\n        No plugins available. Click \"Add Plugin\" to add your first plugin.\n      </div>\n    </el-card>\n\n    <!-- Add Plugin Dialog -->\n    <el-dialog\n      v-model=\"showAddForm\"\n      title=\"Add New Plugin\"\n      width=\"500px\"\n    >\n      <el-form\n        :model=\"newPlugin\"\n        label-position=\"top\"\n      >\n        <el-form-item label=\"Name\" required>\n          <el-input v-model=\"newPlugin.name\" />\n        </el-form-item>\n        \n        <el-form-item label=\"Version\" required>\n          <el-input v-model=\"newPlugin.version\" />\n        </el-form-item>\n        \n        <el-form-item label=\"Type\" required>\n          <el-select v-model=\"newPlugin.type\" style=\"width: 100%\">\n            <el-option label=\"Game System\" value=\"gameSystem\" />\n            <el-option label=\"Extension\" value=\"extension\" />\n            <el-option label=\"Theme\" value=\"theme\" />\n          </el-select>\n        </el-form-item>\n        \n        <el-form-item label=\"Entry Point\" required>\n          <el-input v-model=\"newPlugin.entryPoint\" placeholder=\"Path to plugin entry file\" />\n        </el-form-item>\n        \n        <el-form-item label=\"Description\">\n          <el-input\n            v-model=\"newPlugin.description\"\n            type=\"textarea\"\n            rows=\"3\"\n          />\n        </el-form-item>\n        \n        <el-form-item label=\"Author\">\n          <el-input v-model=\"newPlugin.author\" />\n        </el-form-item>\n        \n        <el-form-item label=\"Website\">\n          <el-input v-model=\"newPlugin.website\" />\n        </el-form-item>\n        \n        <el-form-item label=\"Status\">\n          <el-switch\n            v-model=\"newPlugin.enabled\"\n            active-text=\"Enabled\"\n            inactive-text=\"Disabled\"\n          />\n        </el-form-item>\n      </el-form>\n      \n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"resetNewPluginForm\">Cancel</el-button>\n          <el-button type=\"primary\" @click=\"addPlugin\" :loading=\"loading\">\n            Add Plugin\n          </el-button>\n        </span>\n      </template>\n    </el-dialog>\n\n    <!-- Edit Plugin Dialog -->\n    <el-dialog\n      v-model=\"showEditForm\"\n      title=\"Edit Plugin\"\n      width=\"500px\"\n    >\n      <el-form\n        :model=\"editPlugin\"\n        label-position=\"top\"\n      >\n        <el-form-item label=\"Name\" required>\n          <el-input v-model=\"editPlugin.name\" />\n        </el-form-item>\n        \n        <el-form-item label=\"Version\" required>\n          <el-input v-model=\"editPlugin.version\" />\n        </el-form-item>\n        \n        <el-form-item label=\"Description\">\n          <el-input\n            v-model=\"editPlugin.description\"\n            type=\"textarea\"\n            rows=\"3\"\n          />\n        </el-form-item>\n        \n        <el-form-item label=\"Author\">\n          <el-input v-model=\"editPlugin.author\" />\n        </el-form-item>\n        \n        <el-form-item label=\"Website\">\n          <el-input v-model=\"editPlugin.website\" />\n        </el-form-item>\n        \n        <el-form-item label=\"Status\">\n          <el-switch\n            v-model=\"editPlugin.enabled\"\n            active-text=\"Enabled\"\n            inactive-text=\"Disabled\"\n          />\n        </el-form-item>\n      </el-form>\n      \n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"showEditForm = false\">Cancel</el-button>\n          <el-button type=\"primary\" @click=\"updatePlugin\" :loading=\"loading\">\n            Save Changes\n          </el-button>\n        </span>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<style scoped>\n.plugin-manager {\n  padding: 20px;\n}\n</style> "],"names":["pluginStore","usePluginStore","authStore","useAuthStore","isAdmin","computed","_a","loading","ref","showAddForm","showEditForm","newPlugin","editPlugin","loadPlugins","error","ElMessage","resetNewPluginForm","prepareEditForm","plugin","addPlugin","updatePlugin","togglePluginStatus","confirmDeletePlugin","ElMessageBox","onMounted"],"mappings":"8oBAQA,MAAMA,EAAcC,EAAe,EAC7BC,EAAYC,EAAa,EAGzBC,EAAUC,GAAS,IAAA,OAAM,QAAAC,EAAAJ,EAAU,OAAV,YAAAI,EAAgB,UAAW,GAAK,EACzDC,EAAUC,EAAI,EAAK,EACnBC,EAAcD,EAAI,EAAK,EACvBE,EAAeF,EAAI,EAAK,EAGxBG,EAAYH,EAAI,CACpB,KAAM,GACN,QAAS,QACT,YAAa,GACb,OAAQ,GACR,QAAS,GACT,KAAM,aACN,WAAY,GACZ,QAAS,EAAA,CACV,EAEKI,EAAaJ,EAAI,CACrB,GAAI,GACJ,KAAM,GACN,QAAS,GACT,YAAa,GACb,OAAQ,GACR,QAAS,GACT,QAAS,EAAA,CACV,EAGD,eAAeK,GAAc,CAC3BN,EAAQ,MAAQ,GACZ,GAAA,CACF,MAAMP,EAAY,aAAa,QACxBc,EAAO,CACdC,EAAU,MAAM,wBAAwB,EAChC,QAAA,MAAM,yBAA0BD,CAAK,CAAA,QAC7C,CACAP,EAAQ,MAAQ,EAAA,CAClB,CAGF,SAASS,GAAqB,CAC5BL,EAAU,MAAQ,CAChB,KAAM,GACN,QAAS,QACT,YAAa,GACb,OAAQ,GACR,QAAS,GACT,KAAM,aACN,WAAY,GACZ,QAAS,EACX,EACAF,EAAY,MAAQ,EAAA,CAGtB,SAASQ,EAAgBC,EAAa,CACpCN,EAAW,MAAQ,CACjB,GAAIM,EAAO,GACX,KAAMA,EAAO,KACb,QAASA,EAAO,QAChB,YAAaA,EAAO,aAAe,GACnC,OAAQA,EAAO,QAAU,GACzB,QAASA,EAAO,SAAW,GAC3B,QAASA,EAAO,OAClB,EACAR,EAAa,MAAQ,EAAA,CAGvB,eAAeS,GAAY,CACrB,GAAA,CACFZ,EAAQ,MAAQ,GACV,MAAAP,EAAY,eAAeW,EAAU,KAAK,EAChDI,EAAU,QAAQ,2BAA2B,EAC1BC,EAAA,EACnB,MAAMH,EAAY,QACXC,EAAO,CACdC,EAAU,MAAM,sBAAsB,EAC9B,QAAA,MAAM,uBAAwBD,CAAK,CAAA,QAC3C,CACAP,EAAQ,MAAQ,EAAA,CAClB,CAGF,eAAea,GAAe,CACxB,GAAA,CACFb,EAAQ,MAAQ,GAChB,MAAMP,EAAY,aAAaY,EAAW,MAAM,GAAIA,EAAW,KAAK,EACpEG,EAAU,QAAQ,6BAA6B,EAC/CL,EAAa,MAAQ,GACrB,MAAMG,EAAY,QACXC,EAAO,CACdC,EAAU,MAAM,yBAAyB,EACjC,QAAA,MAAM,yBAA0BD,CAAK,CAAA,QAC7C,CACAP,EAAQ,MAAQ,EAAA,CAClB,CAGF,eAAec,EAAmBH,EAAa,CACzC,GAAA,CACFX,EAAQ,MAAQ,GACZW,EAAO,SACH,MAAAlB,EAAY,cAAckB,EAAO,EAAE,EACzCH,EAAU,QAAQ,iBAAiB,IAE7B,MAAAf,EAAY,aAAakB,EAAO,EAAE,EACxCH,EAAU,QAAQ,gBAAgB,GAEpC,MAAMF,EAAY,QACXC,EAAO,CACdC,EAAU,MAAM,gCAAgC,EACxC,QAAA,MAAM,gCAAiCD,CAAK,CAAA,QACpD,CACAP,EAAQ,MAAQ,EAAA,CAClB,CAGF,eAAee,EAAoBJ,EAAa,CAC1C,GAAA,CACF,MAAMK,GAAa,QACjB,+CAA+CL,EAAO,IAAI,mCAC1D,gBACA,CACE,kBAAmB,SACnB,iBAAkB,SAClB,KAAM,SAAA,CAEV,EAEAX,EAAQ,MAAQ,GACV,MAAAP,EAAY,iBAAiBkB,EAAO,EAAE,EAC5CH,EAAU,QAAQ,6BAA6B,EAC/C,MAAMF,EAAY,QACXC,EAAO,CACVA,IAAU,WACZC,EAAU,MAAM,yBAAyB,EACjC,QAAA,MAAM,yBAA0BD,CAAK,EAC/C,QACA,CACAP,EAAQ,MAAQ,EAAA,CAClB,CAIF,OAAAiB,GAAU,SAAY,CACpB,MAAMX,EAAY,CAAA,CACnB"}